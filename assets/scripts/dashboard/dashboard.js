import{attachEventHandlerById as e}from"../shared/eventHandlers.js";import{createOptionsBySex as a,createOptionsByAge as t,createOptionsByMortalityByYear as r}from"./chartUtils.js";import{getHighestMortalityPerCountry as o,getHighestMortalityPerYear as l,getHighestMortalityPerSex as s,getHighestMortalityPerAgeGroup as n}from"./dashboardUtils.js";let dashboardGeoJson,dashboardTiles,dashboardInfo=L.control(),selectedDashYear="",dashboardMap,getSummaryDetails=async e=>{let a=await fetch(e).then(e=>e.json()).catch(e=>console.error(`Error fetching data: ${e}`)),t=l(a,selectedDashYear),r=o(a,selectedDashYear),i=s(a,selectedDashYear),d=n(a,selectedDashYear);return{highestMortalityPerYear:{year:t.year,mortality:t.total_mortality},highestMortalityPerSex:{sex:i.sex,mortality:i.mortality},highestMortalityPerCountry:{name:r.name,mortality:r.total_mortality},highestMortalityPerAgeGroup:{age:d.age,mortality:d.mortality}}},renderSummaryToDOM=e=>{let a=document.getElementById("year-column"),t=document.getElementById("country-column"),r=document.getElementById("age-column"),o=document.getElementById("sex-column"),l=a.querySelector(".number"),s=a.querySelector(".value");l.textContent=`${e.highestMortalityPerYear.mortality}`,s.textContent=`${e.highestMortalityPerYear.year}`;let n=t.querySelector(".number"),i=t.querySelector(".value");n.textContent=`${e.highestMortalityPerCountry.mortality}`,i.textContent=`${e.highestMortalityPerCountry.name}`;let d=r.querySelector(".number"),h=r.querySelector(".value");d.textContent=`${e.highestMortalityPerAgeGroup.mortality}`,h.textContent=`${e.highestMortalityPerAgeGroup.age}`;let y=o.querySelector(".number"),g=o.querySelector(".value");y.textContent=`${e.highestMortalityPerSex.mortality}`,g.textContent=`${e.highestMortalityPerSex.sex}`},highestMortalityBarGraph=async e=>{let a=document.getElementById("mortality-countries"),t=await fetch(e).then(e=>e.json()).catch(e=>console.error("Error fetching data:",e)),r=t.filter(e=>"All"!==e.name&&(selectedDashYear?e.year===selectedDashYear:"All"===e.year)).sort((e,a)=>a.total_mortality-e.total_mortality).slice(0,10),o=t.filter(e=>"All"===e.name&&(selectedDashYear?e.year===selectedDashYear:"All"===e.year)).reduce((e,a)=>a.total_mortality>e?a.total_mortality:e.total_mortality).total_mortality;a.innerHTML="",r.forEach(e=>{let t=e.total_mortality/o*100,r=renderGroup(e.name,e.total_mortality,t);a.innerHTML+=r})},renderGroup=(e,a,t)=>`
  <div class="group">
    <div class="detail">
        <span class="name">${e}</span>
        <div class="value-group">
        <span class="value">(${t.toFixed(2)}%)</span>
          <span class="value">${a||"N/A"} </span>
        </div>
    </div>
    <div class="bar" id="${e.toLowerCase().replace(/\s+/g,"")}">
        <div class="percentage" style="width: ${t}%;"></div>
    </div>
  </div>
`,mapDataLoading=async(e,a)=>{dashboardMap.setView([0,0],0),dashboardTiles=L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(dashboardMap);let t=await fetch(e).then(e=>e.json()).catch(e=>console.error(`Error fetching JSON data: ${e}`));L.geoJson(t).addTo(dashboardMap),highestMortalityBarGraph(a)},summaryDataLoading=async e=>{let a=await getSummaryDetails(e);renderSummaryToDOM(a)},barGraphDataLoading=async e=>{let r=(await fetch(e).then(e=>e.json()).catch(e=>console.error(`Error fetching JSON data: ${e}`))).find(e=>"All"===e.name&&(selectedDashYear?e.year===selectedDashYear:"All"===e.year)),o=r.male,l=r.female,s=r.age_group_5_to_14,n=r.age_group_15_to_24,i=r.age_group_25_to_34,d=r.age_group_35_to_54,h=r.age_group_55_to_74,y=r.age_group_75_plus,g=a(o,l),m=t(s,n,i,d,h,y);var c=new ApexCharts(document.querySelector("#sex-chart"),g),p=new ApexCharts(document.querySelector("#age-chart"),m);c.render(),p.render()},lineGraphDataLoading=async e=>{var a;let t=(await fetch(e).then(e=>e.json()).catch(e=>console.error(`Error fetching JSON data: ${e}`))).filter(e=>"All"===e.name&&"All"!==e.year),o=t.map(e=>e.total_mortality),l=t.map(e=>e.year),s,n=r(o,t.map(e=>e.male),t.map(e=>e.female),l);new ApexCharts(document.querySelector("#line-chart"),n).render()},handleYearUpdate=e=>{let a="assets/json/data.json";selectedDashYear=parseInt(e.target.value,10),summaryDataLoading(a),highestMortalityBarGraph(a),barGraphDataLoading(a),lineGraphDataLoading(a)},setupDashboardLoadingandListeners=()=>{console.log("Dashboard loading and event listeners are running...");let a="assets/json/data.json";document.getElementById("dashboardMap")&&(dashboardMap=L.map("dashboardMap",{zoomControl:!1,dragging:!1,scrollWheelZoom:!1}),summaryDataLoading(a),mapDataLoading("assets/json/map.json",a),barGraphDataLoading(a),lineGraphDataLoading(a),e("year-select","change",handleYearUpdate))};setupDashboardLoadingandListeners();